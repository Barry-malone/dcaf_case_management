// rerack fields
$('#patient_appointment_date')
  .parent()
  .find('span.help-block')
  .text('Approx gestation at appt: <%= @patient.last_menstrual_period_at_appt %>');

// rerack status
$('#patient_status').text('<%= @patient.status %>');

// rerack current LMP
$('#patient_last_menstrual_period_weeks')
  .parent()
  .find('span.help-block')
  .text('Currently: <%= @patient.last_menstrual_period_display_short %>');

// refresh entire changelog and notes sections
$('#change_log').html(
  '<%= escape_javascript(render partial: "patients/change_log", locals: { patient: @patient })%>'
);

$('#patient_urgent_flag').prop('checked', <%= @patient.urgent_flag? %>);

// if pledge is sent, re-rack fulfillment info
<% if current_user.allowed_data_access? && @patient.pledge_sent? %>
  // populate the fulfillment form if it's supposed to be there
  $('#fulfillment').empty()
                   .append('<%= escape_javascript(render partial: "patients/fulfillment", locals: { patient: @patient })%>');
  $('#menu').html(
    '<%= escape_javascript(render partial: "patients/menu", locals: { patient: @patient })%>'
  );
<% else %>
  // ensure fulfillment form is cleared out
  $('#fulfillment').empty();
<% end %>

// flash the result
$('#flash').html('<%= escape_javascript(render partial: "layouts/messages") %>');
$('#flash').removeClass().hide().fadeIn('slow')
